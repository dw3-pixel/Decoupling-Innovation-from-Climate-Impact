---
title: Analyzing the Conflict Between Industrial Growth (SDG 9) and Climate Action
  (SDG13)
author: "Dorothy Worbie"
output:
  html_document: 
    self_contained: true 
    theme: cosmo         
  pdf_document: null    
fontsize: 11pt
---

```{r setup, include=FALSE}
# Global options to display code, results, and figures
# This ensures all subsequent code chunks show their output and code

knitr::opts_chunk$set(echo = TRUE,      # Show the code
                      eval = TRUE,      # Run the code
                      results = 'markup', # Show the text output
                      fig.align = 'center', # Center all plots
                      fig.width = 8, 
                      fig.height = 5)
```

# Executive Summary

1. Initial analysis of this data revealed a strong negative correlation between Innovation (SDG 9) and Climate Action (SDG 13). However, through multiple regression modeling, the final analysis concluded that this trade-off is misleading. The negative effect of SDG 9 disappears when controlling for Unsustainable Consumption (SDG 12) and Sustainable Cities (SDG 11).

# 1. Data Preparation and Initial Exploration

 ___1.1 Data Source and Initial Preparation___

This dataset, originally sourced as a **.xlsx file from the Sustainable Development Report website, underwent initial cleaning and preparation in Microsoft Excel. This involved removing duplicate entries, ensuring consistent data formatting and correcting typographical errors. Additionally, minor descriptive statistical analysis was performed in Excel to gain a foundational understanding of the data structure. The current file imported into R is a pre-processed version, and all other subsequent in-depth statistical analysis, modelling and visualizations will be done using R.

___1.2 Installing packages and loading libraries___

```{r libraries, message=FALSE, warning=FALSE}

#install.packages("tidyverse")
# install.packages("readxl")
# install.packages("ppcor")
# install.packages("car")

library(tidyverse)
library(ggplot2)
library(ppcor)
library(car)
library(dplyr)
```

___1.3 Importing & Cleaning___

```{r data-import}
# Reading the dataset
Correlation.Data <- read.csv("/Users/D./Downloads/Correlation Data.csv", header = TRUE) 

sdg_data <- read.csv("/Users/D./Downloads/Correlation Data.csv", header = TRUE) 

sdg_data <- Correlation.Data 

# Inspecting the first few rows and structure to confirm successful import

# View(sdg_data)  # Commented out for smooth  knitting

str(sdg_data)
head(sdg_data)

# Data import and removing NA values

sdg_analysis <- sdg_data %>% 
  
  # Remov NAs first
  na.omit() %>%
  
  # 1. Renaming the original columns (goal9, goal13) to the clean names (sdg_9, sdg_13)
  # Force R to use the dplyr::rename function (this was done to prevent multiple error messages)
  dplyr::rename(sdg_9 = goal9, 
                sdg_13 = goal13) %>% 
  
  # 2. Select and reorder the final columns (using the NEW names)
  # Force R to use the dplyr::select function
  
  dplyr::select(Country, sdg_9, sdg_13)
  
```

___1.4 Exploratory Data Analysis (EDA)___

Visual Inspection (Histograms) - justify the choice of a non-parametric test (Spearman's ρ).

```{r sdg9-distribution}
# Distribution of SDG 9 scores (Outlier/Skewness Check)

ggplot(sdg_analysis, aes(x = sdg_9)) +
  geom_histogram(binwidth = 5, fill = "#4169E1", color = "black") +
  labs(
    title = "Distribution of SDG 9 Scores", 
    x = "SDG 9 Score", 
    y = "Count of Countries"
  ) +
  theme_minimal()
```

```{r sdg13-boxplot}
# Box plot for SDG 13 to identify specific outliers

ggplot(sdg_analysis, aes(y = sdg_13)) +
  geom_boxplot(fill = "#4169E1", color = "black") +
  labs(
    title = "Box Plot of SDG 13 Scores (Outlier Check)", 
    y = "SDG 13 Score"
  ) +
  theme_minimal()
```

___Observation:___ The skewed distribution (especially for SDG 13) proves the importance of using Spearman's Rank Correlation as a better option for focus on ranks instead of raw numbers, for data reliability (in this case with messy data and extreme outliers).

# 2. Correlational Analysis and Reliability

___2.1 Calculating and Testing Spearman's ρ___

```{r spearman-test}
# Formally testing the Spearman's rank correlation coefficient (ρ) 

spearman_test_result <- cor.test(sdg_analysis$sdg_9, 
                                  sdg_analysis$sdg_13, 
                                  method = "spearman", 
                                  exact = FALSE)

print(spearman_test_result)
```

___2.2 Visualizing the Rank Relationship___

```{r rank-visualization}

plot(rank(sdg_analysis$sdg_9), rank(sdg_analysis$sdg_13), 
     main = expression(paste("Spearman Rank Correlation Visualization (", rho, " = -0.796)")),
     xlab = "Rank of SDG 9 (Innovation)", 
     ylab = "Rank of SDG 13 (Climate Action)")
```

___2.3 Data Reliability Check (Kendall's τ)___

```{r kendall-test}
# Confirming robustness using the alternative non-parametric coefficient, Kendall's Tau (τ)
kendall_test <- cor.test(sdg_analysis$sdg_9, 
                         sdg_analysis$sdg_13, 
                         method = "kendall")

print(kendall_test)
```

# 3. Investigating Confounding Variables

Investigating granular drivers like SDG Goals 7, 11, etc. for further investigation.

___3.1 Merging and Ordering the Full Dataset___

```{r merge-data}
# Loading the second dataset containing sdg_6, sdg_7, sdg_11, sdg_12 and merging to previous dataframe used for earlier analysis

new_sdg_data <- read.csv("/Users/D./Downloads/New correlation data.csv", header = TRUE) 

sdg_analysis_merged <- merge(
    x = sdg_analysis, 
    y = new_sdg_data, 
    by = "Country", 
    all.x = FALSE
)

# Checking first few rows
head(sdg_analysis_merged)

# Assigning the final, processed data frame to sdg_analysis_cleaned

sdg_analysis_cleaned <- sdg_analysis_merged %>%
  
  # 1. Cleaning the data to remove NA rows resulting from the merge
  na.omit() %>%
  
  # 2. Arranging the columns in  order for easy readability
  dplyr::select(
    Country,
    sdg_6, 
    sdg_7, 
    sdg_9,
    sdg_11, 
    sdg_12, 
    sdg_13
  )

# Confirming the cleaned dataframe 
head(sdg_analysis_cleaned)

```

___3.2 Partial Correlation (Controlling for SDG 11)___

The rationale is to use the SDG_11 as a proxy for infrastructural/development to verify if the conflict is simply due to wealth.

```{r partial-correlation}
# Calculate the Spearman partial correlation (SDG 9 vs. SDG 13, controlling for SDG 11)
partial_rho_11 <- pcor.test(sdg_analysis_cleaned$sdg_9, 
                            sdg_analysis_cleaned$sdg_13, 
                            sdg_analysis_cleaned$sdg_11, 
                            method = "spearman")

print(partial_rho_11)
```

___3.3 Granular Correlation Matrix___

Rationale is to identify which goals have the strongest relationships with the main variables (SDG 9 & SDG 13).

```{r correlation-matrix}
# Creating a Subset of the data for the six relevant goals

sdg_subset <- sdg_analysis_cleaned[, c("sdg_6", "sdg_7", "sdg_9", "sdg_11", "sdg_12", "sdg_13")]

# Calculating  the Spearman correlation matrix

cor_matrix <- cor(sdg_subset, method = "spearman", use = "complete.obs")

print(cor_matrix)
```

# 4. Final Causal Quantification (Multiple Linear Regression)

___4.1 Building the Final Model___

The goal of the final model is to see if the negative link between SDG 9 (Innovation) and SDG 13 (Climate Action) is fake (misleading).

```{r final-model}
# Building the model: SDG 13 explained by SDG 9, SDG 12, and SDG 11
final_model <- lm(sdg_13 ~ sdg_9 + sdg_12 + sdg_11, 
                  data = sdg_analysis_cleaned)

summary(final_model)
```

 ___4.2 Visualizing Final Model Coefficients (Statistical Significance)___

This plot visually represents the final proof that shows which variables are real problems for the climate and which ones are not.

```{r coefficient-plot, fig.width=10, fig.height=6}

# Extracting and calculating CIs using the built-in confint() function

model_summary <- as.data.frame(summary(final_model)$coefficients)
model_summary$Predictor <- rownames(model_summary)

# Calculating  95% Confidence Intervals

conf_intervals <- confint(final_model)
model_summary$Lower_CI <- conf_intervals[, 1]
model_summary$Upper_CI <- conf_intervals[, 2]

# Filtering out the intercept for cleaner plotting

model_data <- model_summary[-1, ]

# Creating the visualization
coef_plot <- ggplot(model_data, aes(x = Estimate, y = Predictor)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray50") +
  geom_errorbarh(aes(xmin = Lower_CI, xmax = Upper_CI), 
                 height = 0.2, color = "darkred") +
  geom_point(size = 3, color = "black") +
  scale_y_discrete(labels = c(
    "sdg_9" = "SDG 9 (Innovation)",
    "sdg_12" = "SDG 12 (Consumption)",
    "sdg_11" = "SDG 11 (Cities)"
  )) +
  labs(
    title = "Independent Effect of SDGs on Climate Action (SDG 13)",
    subtitle = "95% Confidence Intervals shown. Crossing the dashed line means non-significant.",
    x = "Coefficient Estimate",
    y = "Predictor Variable"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))
  
print(coef_plot)
```

## 4.3 Partial Residual Plots

```{r avplots, fig.width=10, fig.height=8}

# Generate partial residual plots for all predictors in the model

car::avPlots(final_model, 
             main = "Partial Residual Plots: Independent Effects on SDG 13",
             col = "blue")
```
